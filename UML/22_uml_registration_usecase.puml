@startuml UML_Registration_UseCase

title UML Use Case - Регистрация пользователей

left to right direction
skinparam packageStyle rectangle

actor "HR менеджер" as HR
actor "Администратор" as Admin
actor "Новый сотрудник" as NewUser

package "Система умного КПП" {
  usecase "Регистрация\nнового пользователя" as UC1
  usecase "Ввод персональных\nданных" as UC1_1
  usecase "Захват биометрии\n(фото лица)" as UC1_2
  usecase "Регистрация\nтранспорта" as UC1_3
  usecase "Назначение прав\nдоступа" as UC1_4
  usecase "Валидация данных" as UC1_5
  usecase "Генерация face\nembeddings" as UC1_6
  usecase "Сохранение в БД" as UC1_7
  
  usecase "Редактирование\nпрофиля" as UC2
  usecase "Обновление\nбиометрии" as UC2_1
  usecase "Изменение прав\nдоступа" as UC2_2
  
  usecase "Деактивация\nпользователя" as UC3
  usecase "Удаление\nбиометрических данных" as UC3_1
  
  usecase "Просмотр списка\nпользователей" as UC4
  usecase "Поиск\nпользователя" as UC4_1
  usecase "Фильтрация\nпо критериям" as UC4_2
}

' Связи HR менеджера
HR --> UC1
HR --> UC2
HR --> UC4

' Связи администратора
Admin --> UC1
Admin --> UC2
Admin --> UC3
Admin --> UC4

' Связи нового сотрудника
NewUser ..> UC1_2 : "предоставляет\nфото"

' Include отношения для UC1
UC1 ..> UC1_1 : <<include>>
UC1 ..> UC1_2 : <<include>>
UC1 ..> UC1_5 : <<include>>
UC1 ..> UC1_6 : <<include>>
UC1 ..> UC1_7 : <<include>>

' Extend отношения для UC1
UC1 <.. UC1_3 : <<extend>>
UC1 <.. UC1_4 : <<extend>>

' Include отношения для UC2
UC2 ..> UC1_5 : <<include>>
UC2 ..> UC1_7 : <<include>>

' Extend отношения для UC2
UC2 <.. UC2_1 : <<extend>>
UC2 <.. UC2_2 : <<extend>>

' Include отношения для UC3
UC3 ..> UC3_1 : <<include>>

' Include отношения для UC4
UC4 ..> UC4_1 : <<include>>
UC4 <.. UC4_2 : <<extend>>

note right of UC1
  **Основной сценарий**:
  1. HR открывает форму регистрации
  2. Вводит персональные данные
  3. Загружает 5+ фото лица
  4. Система валидирует данные
  5. Система генерирует embeddings
  6. Система сохраняет в БД
  7. Подтверждение регистрации
  
  **Предусловия**:
  - Пользователь авторизован
  - Есть права на регистрацию
  
  **Постусловия**:
  - Пользователь создан в системе
  - Биометрия сохранена
  - Можно распознать на КПП
end note

note right of UC1_2
  **Требования к фото**:
  - Минимум 5 изображений
  - Разрешение ≥640×640 px
  - Разные ракурсы (фас, ¾, профиль)
  - Хорошее освещение
  - Лицо занимает ≥30% кадра
  - Без масок, очков (желательно)
end note

note right of UC1_6
  **Генерация embeddings**:
  - Модель: ArcFace (ResNet-100)
  - Детекция лица (RetinaFace)
  - Alignment по 5 landmarks
  - Извлечение 512-dim вектора
  - Усреднение векторов (5 фото)
  - L2 нормализация
  
  **Время**: ~500ms (GPU)
end note

note left of UC2
  **Сценарий редактирования**:
  - Изменение контактов
  - Обновление должности
  - Обновление фото (при изменении внешности)
  - Изменение прав доступа (только Admin)
  
  **Версионирование**:
  - Сохранение истории изменений
  - Audit trail (кто, когда, что изменил)
end note

note left of UC3
  **Деактивация**:
  - Soft delete (флаг is_active = false)
  - Биометрия НЕ удаляется (audit)
  - Доступ немедленно блокируется
  - Возможность восстановления
  
  **Причины**:
  - Увольнение
  - Временная блокировка
  - Окончание срока договора
end note

@enduml
